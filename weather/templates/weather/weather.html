<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeatherCast</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-from: #0b1a33;
      --bg-via: #122347;
      --bg-to: #1a3a6b;
      --glass: rgba(255, 255, 255, 0.06);
      --glass-hover: rgba(255, 255, 255, 0.10);
      --glass-border: rgba(255, 255, 255, 0.10);
      --glass-border-light: rgba(255, 255, 255, 0.15);
      --shadow: rgba(0, 0, 0, 0.25);
      --text: #ffffff;
      --text-2: rgba(255, 255, 255, 0.72);
      --text-3: rgba(255, 255, 255, 0.45);
      --accent: #5b9cf6;
      --accent-warm: #f6a35b;
      --radius: 18px;
      --radius-sm: 14px;
    }

    html { font-size: 16px; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      background: linear-gradient(160deg, var(--bg-from) 0%, var(--bg-via) 40%, var(--bg-to) 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      transition: background 1.2s ease;
    }

    body.night {
      --bg-from: #050d1a;
      --bg-via: #0a1628;
      --bg-to: #0f1f3d;
    }

    /* --- Ambient background glow --- */
    body::before {
      content: '';
      position: fixed;
      top: -30%;
      right: -10%;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(91,156,246,0.12) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      bottom: -20%;
      left: -10%;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(246,163,91,0.08) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1060px;
      margin: 0 auto;
      padding: 20px 24px 48px;
    }

    /* =========================================
       HEADER
       ========================================= */
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 28px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-right: auto;
      flex-shrink: 0;
    }

    .brand-logo {
      width: 34px;
      height: 34px;
      background: linear-gradient(135deg, var(--accent), #83b9ff);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .brand-logo svg { width: 20px; height: 20px; }

    .brand-name {
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .brand-name span { color: var(--accent); }

    .search-wrapper {
      position: relative;
      width: 340px;
      flex-shrink: 1;
      min-width: 0;
    }

    .search-input {
      width: 100%;
      padding: 10px 14px 10px 38px;
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      background: var(--glass);
      color: var(--text);
      font-family: inherit;
      font-size: 0.88rem;
      backdrop-filter: blur(14px);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }

    .search-input::placeholder { color: var(--text-3); }

    .search-input:focus {
      border-color: var(--accent);
      background: rgba(255,255,255,0.09);
      box-shadow: 0 0 0 3px rgba(91,156,246,0.18);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 15px;
      height: 15px;
      color: var(--text-3);
    }

    .search-results {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      right: 0;
      background: rgba(12, 22, 45, 0.96);
      backdrop-filter: blur(24px);
      border: 1px solid var(--glass-border-light);
      border-radius: var(--radius-sm);
      overflow: hidden;
      z-index: 100;
      display: none;
      box-shadow: 0 16px 48px rgba(0,0,0,0.5);
    }

    .search-results.visible { display: block; }

    .search-result-item {
      padding: 11px 16px;
      cursor: pointer;
      transition: background 0.12s;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .search-result-item:last-child { border-bottom: none; }
    .search-result-item:hover { background: rgba(255,255,255,0.08); }

    .search-result-name {
      font-weight: 500;
      font-size: 0.9rem;
    }

    .search-result-detail {
      font-size: 0.76rem;
      color: var(--text-3);
      margin-top: 1px;
    }

    .btn-location {
      display: flex;
      align-items: center;
      gap: 7px;
      padding: 10px 16px;
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      background: var(--glass);
      color: var(--text);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      backdrop-filter: blur(14px);
      transition: background 0.2s, border-color 0.2s;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .btn-location:hover {
      background: var(--glass-hover);
      border-color: rgba(255,255,255,0.22);
    }

    .btn-location svg { width: 15px; height: 15px; }

    /* =========================================
       STATE SCREENS
       ========================================= */
    .state-message {
      text-align: center;
      padding: 100px 20px 80px;
    }

    .state-message .state-icon {
      font-size: 3.5rem;
      margin-bottom: 18px;
      opacity: 0.6;
    }

    .state-message h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .state-message p {
      color: var(--text-2);
      font-size: 0.95rem;
      max-width: 360px;
      margin: 0 auto;
      line-height: 1.5;
    }

    .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      margin: 0 auto 18px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* =========================================
       GLASS CARD BASE
       ========================================= */
    .card {
      background: var(--glass);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: 0 4px 24px var(--shadow);
      transition: border-color 0.3s;
    }

    .card:hover {
      border-color: var(--glass-border-light);
    }

    /* =========================================
       WEATHER DASHBOARD (hidden until data)
       ========================================= */
    .dashboard {
      display: none;
      gap: 16px;
    }

    .dashboard.visible {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto auto auto;
      animation: fadeUp 0.5s ease both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* --- Hero card (current weather) --- */
    .hero-card {
      grid-column: 1 / -1;
      padding: 32px 36px 28px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
      position: relative;
      overflow: hidden;
    }

    .hero-card::after {
      content: '';
      position: absolute;
      top: -40px;
      right: -40px;
      width: 220px;
      height: 220px;
      background: radial-gradient(circle, rgba(91,156,246,0.1) 0%, transparent 70%);
      pointer-events: none;
    }

    .hero-left { flex: 1; min-width: 0; }

    .hero-location {
      display: flex;
      align-items: baseline;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    .hero-city {
      font-size: 1.65rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }

    .hero-country {
      font-size: 0.88rem;
      color: var(--text-3);
      font-weight: 400;
    }

    .hero-condition {
      font-size: 0.92rem;
      color: var(--text-2);
      margin-bottom: 20px;
    }

    .hero-temp-row {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .hero-icon {
      font-size: 4.2rem;
      line-height: 1;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.2));
    }

    .hero-temp {
      font-size: 5.5rem;
      font-weight: 200;
      letter-spacing: -5px;
      line-height: 1;
    }

    .hero-temp-unit {
      font-size: 2rem;
      font-weight: 300;
      vertical-align: super;
      letter-spacing: 0;
      color: var(--text-2);
    }

    .hero-right {
      text-align: right;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .clock-time {
      font-size: 2.6rem;
      font-weight: 200;
      letter-spacing: 1.5px;
      font-variant-numeric: tabular-nums;
      line-height: 1.1;
    }

    .clock-label {
      font-size: 0.68rem;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
    }

    .clock-date {
      font-size: 0.82rem;
      color: var(--text-2);
    }

    /* --- Details grid --- */
    .details-grid {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .detail-card {
      padding: 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .detail-header {
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .detail-icon {
      width: 16px;
      height: 16px;
      color: var(--text-3);
      flex-shrink: 0;
    }

    .detail-label {
      font-size: 0.7rem;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      font-weight: 600;
    }

    .detail-value {
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: -0.3px;
      line-height: 1;
    }

    .detail-sub {
      font-size: 0.75rem;
      color: var(--text-3);
      margin-top: -4px;
    }

    /* --- Hourly forecast --- */
    .hourly-section {
      grid-column: 1 / -1;
    }

    .section-title {
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: var(--text-3);
      margin-bottom: 12px;
      padding-left: 4px;
    }

    .hourly-card {
      padding: 2px;
    }

    .hourly-scroll {
      display: flex;
      gap: 4px;
      overflow-x: auto;
      padding: 14px 10px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .hourly-scroll::-webkit-scrollbar { height: 4px; }
    .hourly-scroll::-webkit-scrollbar-track { background: transparent; }
    .hourly-scroll::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.12);
      border-radius: 4px;
    }

    .hourly-item {
      flex-shrink: 0;
      width: 68px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 12px 6px;
      border-radius: 14px;
      scroll-snap-align: start;
      transition: background 0.15s;
    }

    .hourly-item:hover { background: rgba(255,255,255,0.06); }

    .hourly-item.now {
      background: rgba(91,156,246,0.15);
      border: 1px solid rgba(91,156,246,0.25);
    }

    .hourly-time {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--text-3);
      text-transform: uppercase;
    }

    .hourly-item.now .hourly-time { color: var(--accent); }

    .hourly-icon { font-size: 1.45rem; line-height: 1; }

    .hourly-temp {
      font-size: 0.88rem;
      font-weight: 600;
    }

    .hourly-precip {
      font-size: 0.65rem;
      color: var(--accent);
      font-weight: 500;
    }

    /* --- 7-day forecast --- */
    .forecast-section {
      grid-column: 1 / -1;
    }

    .forecast-card {
      padding: 8px 20px;
    }

    .forecast-row {
      display: flex;
      align-items: center;
      padding: 13px 0;
      gap: 14px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .forecast-row:last-child { border-bottom: none; }

    .forecast-day-name {
      width: 52px;
      font-size: 0.85rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .forecast-day-name.today { color: var(--accent); }

    .forecast-row-icon {
      font-size: 1.5rem;
      width: 36px;
      text-align: center;
      flex-shrink: 0;
    }

    .forecast-row-desc {
      font-size: 0.82rem;
      color: var(--text-2);
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .forecast-precip-badge {
      font-size: 0.72rem;
      color: var(--accent);
      font-weight: 500;
      width: 42px;
      text-align: right;
      flex-shrink: 0;
    }

    .forecast-temp-range {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .forecast-low-val {
      font-size: 0.85rem;
      color: var(--text-3);
      width: 30px;
      text-align: right;
    }

    .forecast-bar-track {
      width: 100px;
      height: 5px;
      background: rgba(255,255,255,0.08);
      border-radius: 3px;
      position: relative;
      overflow: hidden;
    }

    .forecast-bar-fill {
      position: absolute;
      height: 100%;
      border-radius: 3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-warm));
    }

    .forecast-high-val {
      font-size: 0.85rem;
      font-weight: 600;
      width: 30px;
    }

    /* --- Sun card --- */
    .sun-card-wrap {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .sun-card {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .sun-icon {
      font-size: 1.8rem;
      flex-shrink: 0;
    }

    .sun-info { display: flex; flex-direction: column; gap: 2px; }

    .sun-label {
      font-size: 0.7rem;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: 0.9px;
      font-weight: 600;
    }

    .sun-time {
      font-size: 1.25rem;
      font-weight: 600;
    }

    /* =========================================
       ERROR TOAST
       ========================================= */
    .error-toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(200, 40, 40, 0.92);
      backdrop-filter: blur(14px);
      color: white;
      padding: 12px 28px;
      border-radius: 14px;
      font-size: 0.88rem;
      font-weight: 500;
      z-index: 200;
      transition: transform 0.35s cubic-bezier(0.34,1.56,0.64,1);
      pointer-events: none;
      box-shadow: 0 8px 30px rgba(200,40,40,0.3);
    }

    .error-toast.visible { transform: translateX(-50%) translateY(0); }

    /* =========================================
       RESPONSIVE
       ========================================= */

    /* Tablet */
    @media (max-width: 860px) {
      .details-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .forecast-bar-track { width: 70px; }
    }

    /* Mobile landscape / large phone */
    @media (max-width: 680px) {
      .container { padding: 16px 14px 36px; }

      .header {
        flex-wrap: wrap;
        gap: 10px;
      }

      .brand { width: 100%; }

      .search-wrapper {
        width: auto;
        flex: 1;
        min-width: 0;
      }

      .dashboard.visible {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .hero-card {
        flex-direction: column;
        padding: 24px 22px 22px;
        gap: 20px;
      }

      .hero-right {
        text-align: left;
        align-items: flex-start;
        flex-direction: row;
        gap: 14px;
        align-items: baseline;
      }

      .clock-time { font-size: 1.6rem; }

      .hero-temp { font-size: 4rem; letter-spacing: -3px; }
      .hero-icon { font-size: 3.2rem; }
      .hero-city { font-size: 1.35rem; }

      .details-grid {
        grid-column: 1 / -1;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .detail-value { font-size: 1.2rem; }

      .hourly-section,
      .forecast-section,
      .sun-card-wrap {
        grid-column: 1 / -1;
      }

      .sun-card-wrap { grid-template-columns: 1fr 1fr; }

      .forecast-bar-track { width: 56px; }

      .forecast-row-desc { display: none; }
    }

    /* Small phone */
    @media (max-width: 420px) {
      .header { gap: 8px; }

      .btn-location span { display: none; }
      .btn-location { padding: 10px 12px; }

      .hero-temp { font-size: 3.4rem; letter-spacing: -2px; }
      .hero-icon { font-size: 2.6rem; }
      .hero-temp-unit { font-size: 1.4rem; }

      .details-grid { grid-template-columns: 1fr 1fr; }

      .sun-card-wrap { grid-template-columns: 1fr; }

      .forecast-bar-track { width: 44px; }

      .forecast-card { padding: 8px 12px; }

      .hourly-item { width: 58px; }
    }

    /* Very tall / foldable */
    @media (max-height: 600px) and (orientation: landscape) {
      .state-message { padding: 40px 20px; }
    }
  </style>
</head>
<body>

<div class="container">

  <!-- ===== HEADER ===== -->
  <div class="header">
    <div class="brand">
      <div class="brand-logo">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round">
          <circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32 1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32 1.41-1.41"/>
        </svg>
      </div>
      <div class="brand-name">Weather<span>Cast</span></div>
    </div>

    <div class="search-wrapper">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round">
        <circle cx="11" cy="11" r="7.5"/><path d="m20.5 20.5-4-4"/>
      </svg>
      <input type="text" class="search-input" id="searchInput" placeholder="Search city..." autocomplete="off">
      <div class="search-results" id="searchResults"></div>
    </div>

    <button class="btn-location" id="btnLocation">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round">
        <path d="M12 2v3m0 14v3M2 12h3m14 0h3"/><circle cx="12" cy="12" r="4"/>
      </svg>
      <span>My Location</span>
    </button>
  </div>

  <!-- ===== WELCOME ===== -->
  <div class="state-message" id="welcomeState">
    <div class="state-icon">&#9729;&#65039;</div>
    <h2>Check the forecast</h2>
    <p>Search for any city worldwide or allow location access to get your local weather instantly.</p>
  </div>

  <!-- ===== LOADING ===== -->
  <div class="state-message" id="loadingState" style="display:none;">
    <div class="spinner"></div>
    <h2>Fetching weather data</h2>
    <p>Retrieving conditions and forecast...</p>
  </div>

  <!-- ===== DASHBOARD ===== -->
  <div class="dashboard" id="dashboard">

    <!-- Hero -->
    <div class="hero-card card" id="heroCard">
      <div class="hero-left">
        <div class="hero-location">
          <div class="hero-city" id="cityName">--</div>
          <div class="hero-country" id="countryName"></div>
        </div>
        <div class="hero-condition" id="currentCondition">--</div>
        <div class="hero-temp-row">
          <div class="hero-icon" id="currentIcon"></div>
          <div class="hero-temp" id="currentTemp">--<span class="hero-temp-unit">&deg;C</span></div>
        </div>
      </div>
      <div class="hero-right">
        <div class="clock-label">Local Time</div>
        <div class="clock-time" id="clockTime">--:--</div>
        <div class="clock-date" id="clockDate"></div>
      </div>
    </div>

    <!-- Detail cards -->
    <div class="details-grid" id="detailsGrid">
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 1 1 4 0"/></svg>
          <span class="detail-label">Feels like</span>
        </div>
        <div class="detail-value" id="feelsLike">--</div>
      </div>
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
          <span class="detail-label">Humidity</span>
        </div>
        <div class="detail-value" id="humidity">--</div>
      </div>
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>
          <span class="detail-label">Wind</span>
        </div>
        <div class="detail-value" id="windSpeed">--</div>
        <div class="detail-sub" id="windDir"></div>
      </div>
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v1m0 16v1m-9-9h1m16 0h1m-2.64-6.36-.7.7M6.34 17.66l-.7.7m0-12.02.7.7m11.02 11.02.7.7"/><circle cx="12" cy="12" r="4"/></svg>
          <span class="detail-label">UV Index</span>
        </div>
        <div class="detail-value" id="uvIndex">--</div>
        <div class="detail-sub" id="uvLabel"></div>
      </div>
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V4M4 12l8-8 8 8"/></svg>
          <span class="detail-label">Pressure</span>
        </div>
        <div class="detail-value" id="pressure">--</div>
      </div>
      <div class="detail-card card">
        <div class="detail-header">
          <svg class="detail-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="9" x2="12" y2="2"/><path d="M4.22 10.22l1.42 1.42m12.72 0 1.42-1.42"/></svg>
          <span class="detail-label">Max Wind</span>
        </div>
        <div class="detail-value" id="maxWind">--</div>
      </div>
    </div>

    <!-- Sunrise / Sunset -->
    <div class="sun-card-wrap">
      <div class="sun-card card">
        <div class="sun-icon">&#9728;&#65039;</div>
        <div class="sun-info">
          <div class="sun-label">Sunrise</div>
          <div class="sun-time" id="sunrise">--:--</div>
        </div>
      </div>
      <div class="sun-card card">
        <div class="sun-icon">&#127749;</div>
        <div class="sun-info">
          <div class="sun-label">Sunset</div>
          <div class="sun-time" id="sunset">--:--</div>
        </div>
      </div>
    </div>

    <!-- Hourly forecast -->
    <div class="hourly-section">
      <div class="section-title">Next 24 Hours</div>
      <div class="hourly-card card">
        <div class="hourly-scroll" id="hourlyScroll"></div>
      </div>
    </div>

    <!-- 7-day forecast -->
    <div class="forecast-section">
      <div class="section-title">7-Day Forecast</div>
      <div class="forecast-card card" id="forecastList"></div>
    </div>

  </div><!-- /dashboard -->
</div>

<!-- Error toast -->
<div class="error-toast" id="errorToast"></div>

<script>
(function () {
  /* ── DOM refs ── */
  const $ = (id) => document.getElementById(id);
  const searchInput    = $('searchInput');
  const searchResults  = $('searchResults');
  const btnLocation    = $('btnLocation');
  const welcomeState   = $('welcomeState');
  const loadingState   = $('loadingState');
  const dashboard      = $('dashboard');
  const errorToast     = $('errorToast');

  let clockInterval = null;
  let currentTimezone = 'UTC';
  let debounceTimer = null;

  /* ── WMO weather codes ── */
  const WMO = {
    0:  { d: 'Clear sky',           i: (n) => n ? '\u2600\uFE0F' : '\uD83C\uDF11' },
    1:  { d: 'Mainly clear',        i: (n) => n ? '\uD83C\uDF24\uFE0F' : '\uD83C\uDF19' },
    2:  { d: 'Partly cloudy',       i: () => '\u26C5' },
    3:  { d: 'Overcast',            i: () => '\u2601\uFE0F' },
    45: { d: 'Fog',                 i: () => '\uD83C\uDF2B\uFE0F' },
    48: { d: 'Rime fog',            i: () => '\uD83C\uDF2B\uFE0F' },
    51: { d: 'Light drizzle',       i: () => '\uD83C\uDF26\uFE0F' },
    53: { d: 'Moderate drizzle',    i: () => '\uD83C\uDF26\uFE0F' },
    55: { d: 'Dense drizzle',       i: () => '\uD83C\uDF27\uFE0F' },
    56: { d: 'Freezing drizzle',    i: () => '\uD83C\uDF27\uFE0F' },
    57: { d: 'Heavy freezing drizzle', i: () => '\uD83C\uDF27\uFE0F' },
    61: { d: 'Slight rain',         i: () => '\uD83C\uDF26\uFE0F' },
    63: { d: 'Moderate rain',       i: () => '\uD83C\uDF27\uFE0F' },
    65: { d: 'Heavy rain',          i: () => '\uD83C\uDF27\uFE0F' },
    66: { d: 'Freezing rain',       i: () => '\uD83C\uDF27\uFE0F' },
    67: { d: 'Heavy freezing rain', i: () => '\uD83C\uDF27\uFE0F' },
    71: { d: 'Light snow',          i: () => '\uD83C\uDF28\uFE0F' },
    73: { d: 'Moderate snow',       i: () => '\uD83C\uDF28\uFE0F' },
    75: { d: 'Heavy snow',          i: () => '\u2744\uFE0F' },
    77: { d: 'Snow grains',         i: () => '\u2744\uFE0F' },
    80: { d: 'Light showers',       i: () => '\uD83C\uDF26\uFE0F' },
    81: { d: 'Moderate showers',    i: () => '\uD83C\uDF27\uFE0F' },
    82: { d: 'Heavy showers',       i: () => '\uD83C\uDF27\uFE0F' },
    85: { d: 'Light snow showers',  i: () => '\uD83C\uDF28\uFE0F' },
    86: { d: 'Heavy snow showers',  i: () => '\u2744\uFE0F' },
    95: { d: 'Thunderstorm',        i: () => '\u26C8\uFE0F' },
    96: { d: 'Thunderstorm, hail',  i: () => '\u26C8\uFE0F' },
    99: { d: 'Severe thunderstorm', i: () => '\u26C8\uFE0F' },
  };

  function wmo(code, isDay) {
    const e = WMO[code] || { d: 'Unknown', i: () => '\uD83C\uDF10' };
    return { desc: e.d, icon: e.i(isDay) };
  }

  /* ── Wind direction label ── */
  function windLabel(deg) {
    const dirs = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
    return dirs[Math.round(deg / 22.5) % 16];
  }

  /* ── UV label ── */
  function uvLabel(val) {
    if (val <= 2) return 'Low';
    if (val <= 5) return 'Moderate';
    if (val <= 7) return 'High';
    if (val <= 10) return 'Very high';
    return 'Extreme';
  }

  /* ── State management ── */
  function showState(s) {
    welcomeState.style.display = s === 'welcome' ? '' : 'none';
    loadingState.style.display = s === 'loading' ? '' : 'none';
    dashboard.classList.toggle('visible', s === 'weather');
  }

  function showError(msg) {
    errorToast.textContent = msg;
    errorToast.classList.add('visible');
    setTimeout(() => errorToast.classList.remove('visible'), 4500);
  }

  /* ── Clock ── */
  function startClock(tz) {
    currentTimezone = tz;
    if (clockInterval) clearInterval(clockInterval);
    tick();
    clockInterval = setInterval(tick, 1000);
  }

  function tick() {
    const now = new Date();
    try {
      $('clockTime').textContent = now.toLocaleTimeString('en-GB', {
        timeZone: currentTimezone, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false,
      });
      $('clockDate').textContent = now.toLocaleDateString('en-US', {
        timeZone: currentTimezone, weekday: 'long', month: 'short', day: 'numeric',
      });
    } catch { $('clockTime').textContent = '--:--'; }
  }

  /* ── Search ── */
  searchInput.addEventListener('input', () => {
    clearTimeout(debounceTimer);
    const q = searchInput.value.trim();
    if (q.length < 2) { searchResults.classList.remove('visible'); return; }
    debounceTimer = setTimeout(() => fetchCities(q), 280);
  });
  searchInput.addEventListener('keydown', (e) => { if (e.key === 'Escape') searchResults.classList.remove('visible'); });
  document.addEventListener('click', (e) => {
    if (!searchResults.contains(e.target) && e.target !== searchInput) searchResults.classList.remove('visible');
  });

  async function fetchCities(q) {
    try {
      const r = await fetch(`/weather/api/geocode/?q=${encodeURIComponent(q)}`);
      const d = await r.json();
      renderSearch(d.results || []);
    } catch { searchResults.classList.remove('visible'); }
  }

  function renderSearch(results) {
    if (!results.length) { searchResults.classList.remove('visible'); return; }
    searchResults.innerHTML = results.map((r, i) => `
      <div class="search-result-item" data-i="${i}">
        <div class="search-result-name">${esc(r.name)}</div>
        <div class="search-result-detail">${esc((r.admin1 ? r.admin1 + ', ' : '') + r.country)}</div>
      </div>`).join('');
    searchResults.querySelectorAll('.search-result-item').forEach(el => {
      el.addEventListener('click', () => {
        const r = results[+el.dataset.i];
        searchInput.value = r.name;
        searchResults.classList.remove('visible');
        loadWeather(r.latitude, r.longitude, r.name, r.country, r.timezone);
      });
    });
    searchResults.classList.add('visible');
  }

  /* ── Geolocation ── */
  btnLocation.addEventListener('click', () => {
    if (!navigator.geolocation) { showError('Geolocation not supported.'); return; }
    showState('loading');
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude: la, longitude: lo } = pos.coords;
        try {
          const r = await fetch(`/weather/api/reverse-geocode/?lat=${la}&lon=${lo}`);
          const g = await r.json();
          loadWeather(la, lo, g.city, g.country);
        } catch { showError('Could not determine location.'); showState('welcome'); }
      },
      () => { showError('Location access denied.'); showState('welcome'); },
      { enableHighAccuracy: false, timeout: 10000 }
    );
  });

  /* ── Fetch & render ── */
  async function loadWeather(lat, lon, city, country, tz) {
    showState('loading');
    try {
      const r = await fetch(`/weather/api/weather/?lat=${lat}&lon=${lon}`);
      if (!r.ok) throw 0;
      const d = await r.json();
      if (d.error) throw 0;
      render(d, city, country, tz);
    } catch { showError('Failed to load weather data.'); showState('welcome'); }
  }

  function render(data, city, country, timezone) {
    const tz = timezone || data.timezone || 'UTC';
    const cur = data.current;
    const daily = data.daily;
    const hourly = data.hourly;
    const isDay = cur.is_day === 1;

    document.body.classList.toggle('night', !isDay);

    /* Hero */
    $('cityName').textContent = city || 'Unknown';
    $('countryName').textContent = country || '';
    const info = wmo(cur.weather_code, isDay);
    $('currentIcon').textContent = info.icon;
    $('currentTemp').innerHTML = `${Math.round(cur.temperature_2m)}<span class="hero-temp-unit">&deg;C</span>`;
    $('currentCondition').textContent = info.desc;

    /* Details */
    $('feelsLike').textContent = `${Math.round(cur.apparent_temperature)}\u00B0C`;
    $('humidity').textContent = `${cur.relative_humidity_2m}%`;
    $('windSpeed').textContent = `${Math.round(cur.wind_speed_10m)} km/h`;
    $('windDir').textContent = windLabel(cur.wind_direction_10m);
    $('pressure').textContent = `${Math.round(cur.surface_pressure)} hPa`;

    const uv = daily.uv_index_max ? daily.uv_index_max[0] : null;
    $('uvIndex').textContent = uv != null ? uv.toFixed(1) : '--';
    $('uvLabel').textContent = uv != null ? uvLabel(uv) : '';
    $('maxWind').textContent = daily.wind_speed_10m_max ? `${Math.round(daily.wind_speed_10m_max[0])} km/h` : '--';

    /* Sunrise / Sunset */
    function fmtTime(iso) {
      if (!iso) return '--:--';
      const d = new Date(iso);
      return d.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false });
    }
    $('sunrise').textContent = fmtTime(daily.sunrise ? daily.sunrise[0] : null);
    $('sunset').textContent = fmtTime(daily.sunset ? daily.sunset[0] : null);

    /* Clock */
    startClock(tz);

    /* Hourly */
    const scroll = $('hourlyScroll');
    scroll.innerHTML = '';
    if (hourly && hourly.time) {
      const len = Math.min(hourly.time.length, 24);
      for (let i = 0; i < len; i++) {
        const dt = new Date(hourly.time[i]);
        const hh = dt.getHours().toString().padStart(2, '0') + ':00';
        const hIsDay = hourly.is_day ? hourly.is_day[i] === 1 : true;
        const hi = wmo(hourly.weather_code[i], hIsDay);
        const prec = hourly.precipitation_probability ? hourly.precipitation_probability[i] : 0;
        const item = document.createElement('div');
        item.className = 'hourly-item' + (i === 0 ? ' now' : '');
        item.innerHTML = `
          <div class="hourly-time">${i === 0 ? 'Now' : hh}</div>
          <div class="hourly-icon">${hi.icon}</div>
          <div class="hourly-temp">${Math.round(hourly.temperature_2m[i])}\u00B0</div>
          ${prec > 0 ? `<div class="hourly-precip">${prec}%</div>` : ''}`;
        scroll.appendChild(item);
      }
    }

    /* 7-day forecast */
    const list = $('forecastList');
    list.innerHTML = '';
    const dayN = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

    // Compute global min/max for bar scaling
    let gMin = Infinity, gMax = -Infinity;
    for (let i = 0; i < daily.time.length; i++) {
      gMin = Math.min(gMin, daily.temperature_2m_min[i]);
      gMax = Math.max(gMax, daily.temperature_2m_max[i]);
    }
    const range = gMax - gMin || 1;

    for (let i = 0; i < daily.time.length; i++) {
      const dt = new Date(daily.time[i] + 'T12:00:00');
      const name = i === 0 ? 'Today' : dayN[dt.getDay()];
      const fi = wmo(daily.weather_code[i], true);
      const lo = Math.round(daily.temperature_2m_min[i]);
      const hi = Math.round(daily.temperature_2m_max[i]);
      const prec = daily.precipitation_probability_max[i];

      const left = ((daily.temperature_2m_min[i] - gMin) / range * 100).toFixed(1);
      const width = (((daily.temperature_2m_max[i] - daily.temperature_2m_min[i]) / range) * 100).toFixed(1);

      const row = document.createElement('div');
      row.className = 'forecast-row';
      row.innerHTML = `
        <div class="forecast-day-name ${i === 0 ? 'today' : ''}">${name}</div>
        <div class="forecast-row-icon">${fi.icon}</div>
        <div class="forecast-row-desc">${fi.desc}</div>
        <div class="forecast-precip-badge">${prec > 0 ? '\uD83D\uDCA7' + prec + '%' : ''}</div>
        <div class="forecast-temp-range">
          <span class="forecast-low-val">${lo}\u00B0</span>
          <div class="forecast-bar-track">
            <div class="forecast-bar-fill" style="left:${left}%;width:${width}%"></div>
          </div>
          <span class="forecast-high-val">${hi}\u00B0</span>
        </div>`;
      list.appendChild(row);
    }

    showState('weather');
  }

  /* ── Util ── */
  function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
})();
</script>
</body>
</html>
